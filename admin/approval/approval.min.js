function fetchExams(status="Pending"){fetch("../../api/exams/getApprovalList.php?status="+status).then((response=>{if(!response.ok)throw new Error("Network response was not ok");return response.json()})).then((data=>{data.success?populateExams(data.exams||[]):showNotification(data.message||"Failed to load exams","error")})).catch((error=>{showNotification("Failed to load exams: "+error.message,"error")}))}function fetchApprovalStats(){}function populateExams(exams){const table=document.getElementById("approvalTable");table.innerHTML="";const approvalCount=document.getElementById("approvalCount");approvalCount&&(approvalCount.textContent=exams.length+" exams found"),0!==exams.length?exams.forEach((exam=>{const startDate=exam.start_datetime?new Date(exam.start_datetime).toLocaleString():"Not set";let statusBadge="";"Pending"===exam.status?statusBadge='<span class="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">Pending</span>':"Approved"===exam.status?statusBadge='<span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Approved</span>':"Rejected"===exam.status?statusBadge='<span class="px-2 py-1 text-xs rounded-full bg-red-100 text-red-800">Rejected</span>':"Draft"===exam.status&&(statusBadge='<span class="px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800">Draft</span>');const row=document.createElement("tr");row.className="hover:bg-gray-50",row.innerHTML=`\n            <td class="px-6 py-4 whitespace-nowrap">\n                <div class="font-medium text-gray-900">${exam.title}</div>\n                <div class="text-sm text-gray-500">Code: ${exam.exam_code}</div>\n                <div class="text-xs text-gray-500 mt-1">Questions: ${exam.question_count||0}</div>\n            </td>\n            <td class="px-6 py-4 whitespace-nowrap">\n                <div class="text-sm text-gray-900">${exam.teacher_name}</div>\n            </td>\n            <td class="px-6 py-4 whitespace-nowrap">\n                <div class="text-sm text-gray-900">${exam.course_code} - ${exam.course_title}</div>\n                <div class="text-xs text-gray-500">${exam.department_name}</div>\n                <div class="text-xs text-gray-500">${exam.program_name}</div>\n            </td>\n            <td class="px-6 py-4 whitespace-nowrap">\n                <div class="text-sm text-gray-900">${exam.duration_minutes} min</div>\n            </td>\n            <td class="px-6 py-4 whitespace-nowrap">\n                ${startDate}\n            </td>\n            <td class="px-6 py-4 whitespace-nowrap">\n                ${statusBadge}\n            </td>\n            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">\n                ${"Pending"===exam.status||"Draft"===exam.status?`\n                <button onclick="approveExam(${exam.exam_id})" class="bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1.5 rounded-lg text-xs font-medium mr-2 transition-colors">\n                    <i class="fas fa-check mr-1"></i> Approve\n                </button>\n                <button onclick="rejectExam(${exam.exam_id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1.5 rounded-lg text-xs font-medium transition-colors">\n                    <i class="fas fa-times mr-1"></i> Reject\n                </button>\n                `:`\n                <div class="text-xs text-gray-500">\n                    ${"Approved"===exam.status?"Approved on ":"Rejected on "}\n                    ${exam.approved_at?new Date(exam.approved_at).toLocaleDateString():"N/A"}\n                </div>\n                `}\n            </td>\n        `,table.appendChild(row)})):table.innerHTML='<tr><td colspan="7" class="px-6 py-4 text-center text-gray-500">No exams pending approval.</td></tr>'}function updateStatCards(stats){}function approveExam(id){Swal.fire({title:"Approve Exam?",text:"This will make the exam available to students based on its scheduled date.",icon:"question",showCancelButton:!0,confirmButtonColor:"#10B981",cancelButtonColor:"#6B7280",confirmButtonText:"Yes, approve it!"}).then((result=>{result.isConfirmed&&processApproval(id,"approve")}))}function rejectExam(id){Swal.fire({title:"Reject Exam",input:"textarea",inputLabel:"Reason for rejection",inputPlaceholder:"Enter the reason why this exam is being rejected...",inputAttributes:{"aria-label":"Reason for rejection"},showCancelButton:!0,confirmButtonColor:"#EF4444",cancelButtonColor:"#6B7280",confirmButtonText:"Reject",cancelButtonText:"Cancel",preConfirm:comment=>(comment||Swal.showValidationMessage("Please provide a reason for rejection"),comment)}).then((result=>{result.isConfirmed&&processApproval(id,"reject",result.value)}))}function processApproval(id,action,comment=""){fetch(`../../api/exams/processApproval.php?exam_id=${id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:action,comment:comment})}).then((response=>{if(!response.ok)throw new Error("Request failed");return response.json()})).then((data=>{data.success?(showNotification(data.message,"success"),fetchExams(),fetchApprovalStats()):showNotification(data.message,"error")})).catch((error=>{showNotification("Operation failed: "+error.message,"error")}))}function setExamDate(id,startDatetime,endDatetime){showNotification("This feature is not yet implemented","info")}function filterApprovals(){fetchExams(document.getElementById("filterStatus").value)}function bulkApprove(){Swal.fire({title:"Bulk Approve?",text:"This will approve all pending exams. Are you sure?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#10B981",cancelButtonColor:"#6B7280",confirmButtonText:"Yes, approve all!"}).then((result=>{result.isConfirmed&&showNotification("Bulk approval feature is not fully implemented yet","info")}))}function exportReport(){showNotification("Generating report...","info"),setTimeout((()=>{showNotification("Report generation is not fully implemented yet","info")}),1500)}function showNotification(message,type="info"){const colors={success:"bg-green-500",error:"bg-red-500",info:"bg-blue-500"},toast=document.createElement("div");toast.className=`fixed top-5 right-5 px-4 py-2 rounded shadow text-white z-50 ${colors[type]||colors.info}`,toast.textContent=message,document.body.appendChild(toast),setTimeout((()=>{toast.remove()}),3e3)}document.addEventListener("DOMContentLoaded",(function(){fetchExams()}));