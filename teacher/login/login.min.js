document.addEventListener("DOMContentLoaded",(function(){const Toast=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:toast=>{toast.addEventListener("mouseenter",Swal.stopTimer),toast.addEventListener("mouseleave",Swal.resumeTimer)}});window.openModal=function(id){document.getElementById(id).classList.remove("hidden"),document.getElementById(id).classList.add("flex")},window.closeModal=function(id){document.getElementById(id).classList.add("hidden")};const loginForm=document.getElementById("teacherLoginForm");loginForm&&loginForm.addEventListener("submit",(function(e){e.preventDefault();const submitBtn=this.querySelector('button[type="submit"]'),originalBtnText=submitBtn.innerHTML;submitBtn.disabled=!0,submitBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Signing in...';const email=document.getElementById("email").value,password=document.getElementById("password").value,remember=document.getElementById("remember").checked;axios.post("/api/login/teacher/processTeacherLogin.php",{email:email,password:password,remember:remember}).then((res=>{const data=res.data;"success"===data.status?(Toast.fire({icon:"success",title:data.message||"Login successful!"}),setTimeout((()=>{window.location.href=data.redirect||"/teacher/dashboard/"}),1e3)):(Toast.fire({icon:"error",title:data.message||"Login failed. Please try again."}),submitBtn.disabled=!1,submitBtn.innerHTML=originalBtnText)})).catch((err=>{Toast.fire({icon:"error",title:"An error occurred. Please try again."}),submitBtn.disabled=!1,submitBtn.innerHTML=originalBtnText}))}));const forgotBtn=document.getElementById("forgotBtn");forgotBtn?.addEventListener("click",(()=>openModal("forgotModal"))),document.getElementById("forgotForm")?.addEventListener("submit",(function(e){e.preventDefault();const contact=document.getElementById("contactInput").value.trim();if(!contact)return Swal.fire({icon:"error",title:"Required",text:"Please enter email or phone number."});window._resetContact=contact,axios.post("/api/forgotPassword/teacher/requestReset.php",{contact:contact}).then((()=>{openModal("otpModal")})).catch((err=>{Swal.fire({icon:"error",title:"Error",text:err.response?.data?.message||"Failed to send OTP."})}))})),document.getElementById("otpForm")?.addEventListener("submit",(function(e){e.preventDefault();const contact=window._resetContact,otpInputs=document.querySelectorAll(".otp-input"),otp=Array.from(otpInputs).map((input=>input.value)).join("");if(6!==otp.length)return Swal.fire({icon:"error",title:"Invalid OTP",text:"Please enter the 6-digit code."});axios.post("/api/forgotPassword/teacher/verifyOtp.php",{contact:contact,otp:otp}).then((()=>{closeModal("otpModal"),openModal("resetModal")})).catch((err=>{Swal.fire({icon:"error",title:"OTP Error",text:err.response?.data?.message||"Failed to verify OTP."})}))})),document.getElementById("resetForm")?.addEventListener("submit",(function(e){e.preventDefault();const password=document.getElementById("new_password").value,confirmPassword=document.getElementById("confirmPassword").value,contact=window._resetContact;if(password!==confirmPassword)return Swal.fire({icon:"error",title:"Mismatch",text:"Passwords do not match."});axios.post("/api/forgotPassword/teacher/resetPassword.php",{contact:contact,password:password}).then((()=>{closeModal("resetModal"),Swal.fire({icon:"success",title:"Password Reset",text:"Your password has been successfully reset!",confirmButtonColor:"#10b981"})})).catch((err=>{Swal.fire({icon:"error",title:"Reset Error",text:err.response?.data?.message||"Could not reset password."})}))})),document.querySelectorAll(".otp-input").forEach(((input,index,inputs)=>{input.addEventListener("input",(()=>{1===input.value.length&&index<inputs.length-1&&inputs[index+1].focus()})),input.addEventListener("keydown",(e=>{"Backspace"===e.key&&""===input.value&&index>0&&inputs[index-1].focus()}))})),document.querySelectorAll("input").forEach((input=>{input.addEventListener("blur",(function(){this.value?(this.classList.remove("border-red-500"),this.classList.add("border-gray-300")):(this.classList.remove("border-gray-300"),this.classList.add("border-red-500"))}))}))}));