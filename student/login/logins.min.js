function initializeLoginForm(){const loginForm=document.getElementById("loginForm"),emailInput=document.getElementById("email"),passwordInput=document.getElementById("password");loginForm.addEventListener("submit",handleLogin),emailInput.addEventListener("blur",validateEmail),emailInput.addEventListener("input",clearFieldError),passwordInput.addEventListener("input",clearFieldError),emailInput.addEventListener("keypress",(function(e){"Enter"===e.key&&passwordInput.focus()})),passwordInput.addEventListener("keypress",(function(e){"Enter"===e.key&&handleLogin(e)}))}function initializePasswordToggle(){const togglePassword=document.getElementById("togglePassword"),passwordInput=document.getElementById("password"),eyeIcon=document.getElementById("eyeIcon");togglePassword.addEventListener("click",(function(){const type="password"===passwordInput.getAttribute("type")?"text":"password";passwordInput.setAttribute("type",type),"password"===type?(eyeIcon.classList.remove("fa-eye-slash"),eyeIcon.classList.add("fa-eye")):(eyeIcon.classList.remove("fa-eye"),eyeIcon.classList.add("fa-eye-slash"))}))}function checkUrlParameters(){const urlParams=new URLSearchParams(window.location.search),error=urlParams.get("error"),message=urlParams.get("message");error&&showNotification(decodeURIComponent(error),"error"),message&&showNotification(decodeURIComponent(message),"success"),(error||message)&&window.history.replaceState({},document.title,window.location.pathname)}async function handleLogin(e){e.preventDefault();const email=document.getElementById("email").value.trim(),password=document.getElementById("password").value,remember=document.getElementById("remember").checked;if(validateForm(email)){Swal.fire({title:"Signing in...",text:"Please wait",allowOutsideClick:!1,showConfirmButton:!1,willOpen:()=>{Swal.showLoading()}});try{const response=await fetch("/api/students/login.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:email,password:password,remember:remember})}),data=await response.json();if(Swal.close(),!data.success)throw new Error(data.message);showNotification("Login successful! Redirecting...","success"),remember?localStorage.setItem("student_email",email):localStorage.removeItem("student_email"),data.data.require_password_reset?setTimeout((()=>{window.location.href="/student/profile/?reset_password=1"}),1500):setTimeout((()=>{window.location.href="/student/dashboard/"}),1500)}catch(error){console.error("Login error:",error),Swal.close(),showNotification(error.message||"Login failed. Please try again.","error")}}}function validateForm(email){let isValid=!0;return clearAllErrors(),email?isValidEmail(email)||(showFieldError("email","Please enter a valid email address"),isValid=!1):(showFieldError("email","Email is required"),isValid=!1),isValid}function validateEmail(){const email=document.getElementById("email").value.trim();return email&&!isValidEmail(email)?(showFieldError("email","Please enter a valid email address"),!1):(clearFieldError("email"),!0)}function isValidEmail(email){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)}function showFieldError(fieldName,message){const field=document.getElementById(fieldName),existingError=field.parentNode.querySelector(".error-message");existingError&&existingError.remove(),field.classList.add("border-red-500","focus:border-red-500","focus:ring-red-500"),field.classList.remove("border-gray-300","focus:border-emerald-500","focus:ring-emerald-500");const errorDiv=document.createElement("div");errorDiv.className="error-message text-red-500 text-sm mt-1",errorDiv.innerHTML=`<i class="fas fa-exclamation-circle mr-1"></i>${message}`,field.parentNode.appendChild(errorDiv)}function clearFieldError(fieldName){const field="string"==typeof fieldName?document.getElementById(fieldName):fieldName.target,errorMessage=field.parentNode.querySelector(".error-message");errorMessage&&errorMessage.remove(),field.classList.remove("border-red-500","focus:border-red-500","focus:ring-red-500"),field.classList.add("border-gray-300","focus:border-emerald-500","focus:ring-emerald-500")}function clearAllErrors(){document.querySelectorAll(".error-message").forEach((error=>error.remove()));["email"].forEach((fieldName=>{const field=document.getElementById(fieldName);field.classList.remove("border-red-500","focus:border-red-500","focus:ring-red-500"),field.classList.add("border-gray-300","focus:border-emerald-500","focus:ring-emerald-500")}))}function setLoadingState(loading){const loginBtn=document.getElementById("loginBtn");loading?(loginBtn.disabled=!0,loginBtn.classList.add("opacity-75","cursor-not-allowed")):(loginBtn.disabled=!1,loginBtn.classList.remove("opacity-75","cursor-not-allowed"))}function shakeForm(){}function showNotification(message,type="info"){const sweetAlertType="success"===type?"success":"error"===type?"error":"warning"===type?"warning":"info";Swal.fire({toast:!0,position:"top-end",icon:sweetAlertType,title:message,showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:toast=>{toast.addEventListener("mouseenter",Swal.stopTimer),toast.addEventListener("mouseleave",Swal.resumeTimer)}})}document.addEventListener("DOMContentLoaded",(function(){initializeLoginForm(),initializePasswordToggle(),checkUrlParameters()})),window.addEventListener("load",(function(){const rememberedEmail=localStorage.getItem("student_email");rememberedEmail?(document.getElementById("email").value=rememberedEmail,document.getElementById("remember").checked=!0,document.getElementById("password").focus()):document.getElementById("email").focus()})),window.addEventListener("popstate",(function(){sessionStorage.getItem("student_logged_in")&&(window.location.href="/student/dashboard/")}));